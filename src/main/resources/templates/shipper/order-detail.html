<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{admin/fragments/header :: header}">
    <title>Chi Ti·∫øt ƒê∆°n H√†ng - Shipper</title>
</head>

<body id="page-top" class="sidebar-toggled">
<nav th:replace="~{admin/fragments/nav-bar :: nav-bar}"></nav>

<div id="wrapper">
    <!-- Sidebar -->
    <ul th:replace="~{shipper/fragments/sidebar :: sidebar}"></ul>

    <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
            <div class="container-fluid">
                <!-- Page Heading -->
                <div class="d-sm-flex align-items-center justify-content-between mb-4">
                    <h1 class="h3 mb-0 text-gray-800">
                        <i class="fas fa-file-invoice text-primary mr-2"></i>
                        Chi Ti·∫øt ƒê∆°n H√†ng
                    </h1>
                    <a th:href="@{/shipper/orders}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left mr-1"></i>Quay l·∫°i danh s√°ch
                    </a>
                </div>

                <!-- Breadcrumbs -->
                <ol class="breadcrumb mb-4">
                    <li class="breadcrumb-item">
                        <a th:href="@{/shipper/dashboard}">Dashboard</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a th:href="@{/shipper/orders}">Danh s√°ch ƒë∆°n h√†ng</a>
                    </li>
                    <li class="breadcrumb-item active">Chi ti·∫øt ƒë∆°n h√†ng</li>
                </ol>

                <!-- Error/Success Messages -->
                <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <span th:text="${error}"></span>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle mr-2"></i>
                    <span th:text="${success}"></span>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="row">
                    <!-- Order Information -->
                    <div class="col-lg-8">
                        <!-- Basic Order Info -->
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    Th√¥ng Tin ƒê∆°n H√†ng
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <table class="table table-borderless">
                                            <tr>
                                                <td><strong>ID ƒê∆°n H√†ng:</strong></td>
                                                <td><code th:text="${order?.id}">ORDER-001</code></td>
                                            </tr>
                                            <tr>
                                                <td><strong>Ng√†y ƒê·∫∑t H√†ng:</strong></td>
                                                <td th:text="${#temporals.format(order?.orderDate, 'dd/MM/yyyy HH:mm')}">
                                                    01/01/2024 10:00
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><strong>Tr·∫°ng Th√°i:</strong></td>
                                                <td>
                                                    <span th:switch="${order?.status}" class="badge badge-pill p-2">
                                                        <span th:case="'PROCESSING'" class="badge badge-warning">
                                                            üîÑ ƒêang x·ª≠ l√Ω
                                                        </span>
                                                        <span th:case="'SHIPPED'" class="badge badge-info">
                                                            üöö ƒêang giao h√†ng
                                                        </span>
                                                        <span th:case="'DELIVERED'" class="badge badge-success">
                                                            üì¶ ƒê√£ giao h√†ng
                                                        </span>
                                                        <span th:case="'CANCELLED'" class="badge badge-danger">
                                                            ‚ùå ƒê√£ h·ªßy
                                                        </span>
                                                        <span th:case="*" class="badge badge-secondary">
                                                            ‚ùì Kh√¥ng x√°c ƒë·ªãnh
                                                        </span>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr th:if="${order?.paymentMethod}">
                                                <td><strong>Ph∆∞∆°ng Th·ª©c Thanh To√°n:</strong></td>
                                                <td>
                                                    <span class="badge badge-light" th:text="${order.paymentMethod}">COD</span>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <table class="table table-borderless">
                                            <tr th:if="${order?.originalAmount != null and order.originalAmount > 0}">
                                                <td><strong>Gi√° G·ªëc:</strong></td>
                                                <td class="text-muted">
                                                    <span th:text="${#numbers.formatDecimal(order.originalAmount, 0, 'COMMA', 0, 'POINT')}">1,200,000</span>‚Ç´
                                                </td>
                                            </tr>
                                            <tr th:if="${order?.discountAmount != null and order.discountAmount > 0}">
                                                <td><strong>Gi·∫£m Gi√°:</strong></td>
                                                <td class="text-danger">
                                                    -<span th:text="${#numbers.formatDecimal(order.discountAmount, 0, 'COMMA', 0, 'POINT')}">200,000</span>‚Ç´
                                                </td>
                                            </tr>
                                            <tr th:if="${order?.shippingFee != null and order.shippingFee > 0}">
                                                <td><strong>Ph√≠ V·∫≠n Chuy·ªÉn:</strong></td>
                                                <td class="text-info">
                                                    <span th:text="${#numbers.formatDecimal(order.shippingFee, 0, 'COMMA', 0, 'POINT')}">30,000</span>‚Ç´
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><strong>T·ªïng Ti·ªÅn:</strong></td>
                                                <td>
                                                    <h5 class="text-success mb-0">
                                                        <span th:text="${#numbers.formatDecimal(order?.totalAmount, 0, 'COMMA', 0, 'POINT')}">1,000,000</span>‚Ç´
                                                    </h5>
                                                </td>
                                            </tr>
                                            <tr th:if="${order?.voucherCode}">
                                                <td><strong>M√£ Voucher:</strong></td>
                                                <td>
                                                    <span class="badge badge-info" th:text="${order.voucherCode}">VOUCHER123</span>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Customer Information -->
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-user mr-2"></i>
                                    Th√¥ng Tin Kh√°ch H√†ng
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <table class="table table-borderless">
                                            <tr>
                                                <td><strong>H·ªç T√™n:</strong></td>
                                                <td th:text="${order?.getCustomerName()}">Nguy·ªÖn VƒÉn A</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Email:</strong></td>
                                                <td th:text="${order?.getCustomerEmail()}">email@example.com</td>
                                            </tr>
                                            <tr th:if="${order?.getCustomerPhone()}">
                                                <td><strong>S·ªë ƒêi·ªán Tho·∫°i:</strong></td>
                                                <td th:text="${order.getCustomerPhone()}">0123456789</td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <table class="table table-borderless">
                                            <tr th:if="${order?.alternativeReceiverName}">
                                                <td><strong>Ng∆∞·ªùi Nh·∫≠n Kh√°c:</strong></td>
                                                <td>
                                                    <span class="text-info" th:text="${order.alternativeReceiverName}">Ng∆∞·ªùi nh·∫≠n kh√°c</span>
                                                </td>
                                            </tr>
                                            <tr th:if="${order?.alternativeReceiverPhone}">
                                                <td><strong>SƒêT Ng∆∞·ªùi Nh·∫≠n:</strong></td>
                                                <td th:text="${order.alternativeReceiverPhone}">0987654321</td>
                                            </tr>
                                            <tr>
                                                <td><strong>ƒê·ªãa Ch·ªâ Giao H√†ng:</strong></td>
                                                <td th:text="${order?.shippingAddress}">
                                                    123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ, TP.HCM
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- Order Items -->
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold ">
                                    <i class="fas fa-box mr-2"></i>
                                    Chi Ti·∫øt S·∫£n Ph·∫©m
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>S·∫£n Ph·∫©m</th>
                                                <th class="text-center">S·ªë L∆∞·ª£ng</th>
                                                <th class="text-right">ƒê∆°n Gi√°</th>
                                                <th class="text-right">Th√†nh Ti·ªÅn</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:if="${#lists.isEmpty(order?.orderDetails)}">
                                                <td colspan="4" class="text-center text-muted py-4">
                                                    Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o trong ƒë∆°n h√†ng n√†y.
                                                </td>
                                            </tr>
                                            <tr th:each="detail : ${order?.orderDetails}">
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <img th:if="${detail?.product?.imageURL != null and !detail?.product?.imageURL.isEmpty()}"
                                                             th:src="@{'/assets/images/product/laptop/' + ${detail?.product?.imageURL}}" 
                                                             class="rounded mr-3" 
                                                             style="width: 60px; height: 60px; object-fit: cover;"
                                                             th:alt="${detail?.product?.name}">
                                                        <div th:if="${detail?.product?.imageURL == null or detail?.product?.imageURL.isEmpty()}"
                                                             class="bg-light rounded mr-3 d-flex align-items-center justify-content-center"
                                                             style="width: 60px; height: 60px;">
                                                            <i class="fas fa-image text-muted"></i>
                                                        </div>
                                                        <div>
                                                            <strong th:text="${detail?.product?.name}">T√™n s·∫£n ph·∫©m</strong>
                                                            <div class="text-muted small" 
                                                                 th:if="${detail != null and detail.product != null and detail.product.categories != null}" 
                                                                 th:text="${detail.product.categories.name}">
                                                                Danh m·ª•c
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="text-center align-middle">
                                                    <span class="badge badge-secondary" th:text="${detail?.quantity}">1</span>
                                                </td>
                                                <td class="text-right align-middle">
                                                    <span th:text="${#numbers.formatDecimal(detail?.unitPrice, 0, 'COMMA', 0, 'POINT')}">1,000,000</span>‚Ç´
                                                </td>
                                                <td class="text-right align-middle">
                                                    <strong>
                                                        <span th:text="${#numbers.formatDecimal(detail?.unitPrice * detail?.quantity, 0, 'COMMA', 0, 'POINT')}">1,000,000</span>‚Ç´
                                                    </strong>
                                                </td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr th:if="${order?.originalAmount != null and order.originalAmount > 0 and order.discountAmount != null and order.discountAmount > 0}">
                                                <th colspan="3" class="text-right">T·∫°m T√≠nh:</th>
                                                <th class="text-right text-muted">
                                                    <span th:text="${#numbers.formatDecimal(order.originalAmount, 0, 'COMMA', 0, 'POINT')}">1,200,000</span>‚Ç´
                                                </th>
                                            </tr>
                                            <tr th:if="${order?.discountAmount != null and order.discountAmount > 0}">
                                                <th colspan="3" class="text-right">Gi·∫£m Gi√°:</th>
                                                <th class="text-right text-danger">
                                                    -<span th:text="${#numbers.formatDecimal(order.discountAmount, 0, 'COMMA', 0, 'POINT')}">200,000</span>‚Ç´
                                                </th>
                                            </tr>
                                            <tr th:if="${order?.shippingFee != null and order.shippingFee > 0}">
                                                <th colspan="3" class="text-right">Ph√≠ V·∫≠n Chuy·ªÉn:</th>
                                                <th class="text-right text-info">
                                                    <span th:text="${#numbers.formatDecimal(order.shippingFee, 0, 'COMMA', 0, 'POINT')}">30,000</span>‚Ç´
                                                </th>
                                            </tr>
                                            <tr class="table-active">
                                                <th colspan="3" class="text-right">T·ªïng C·ªông:</th>
                                                <th class="text-right">
                                                    <h5 class="text-success mb-0">
                                                        <span th:text="${#numbers.formatDecimal(order?.totalAmount, 0, 'COMMA', 0, 'POINT')}">1,000,000</span>‚Ç´
                                                    </h5>
                                                </th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Management -->
                    <div class="col-lg-4">
                        <!-- Current Status -->
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-tasks mr-2"></i>
                                    Qu·∫£n L√Ω Tr·∫°ng Th√°i
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="font-weight-bold">Tr·∫°ng th√°i hi·ªán t·∫°i:</label>
                                    <div class="mt-2">
                                        <span th:switch="${order?.status}" class="badge badge-pill p-3 w-100">
                                            <span th:case="'PROCESSING'" class="badge badge-warning w-100">
                                                üîÑ ƒêang x·ª≠ l√Ω
                                            </span>
                                            <span th:case="'SHIPPED'" class="badge badge-info w-100">
                                                üöö ƒêang giao h√†ng
                                            </span>
                                            <span th:case="'DELIVERED'" class="badge badge-success w-100">
                                                üì¶ ƒê√£ giao h√†ng
                                            </span>
                                            <span th:case="'CANCELLED'" class="badge badge-danger w-100">
                                                ‚ùå ƒê√£ h·ªßy
                                            </span>
                                            <span th:case="*" class="badge badge-secondary w-100">
                                                ‚ùì Kh√¥ng x√°c ƒë·ªãnh
                                            </span>
                                        </span>
                                    </div>
                                </div>

                                <!-- Update Status Form -->
                                <div th:if="${availableStatuses != null and !#lists.isEmpty(availableStatuses)}">
                                    <form method="post" th:action="@{/shipper/orders/update-status}" id="updateStatusForm">
                                        <input type="hidden" name="orderId" th:value="${order?.id}">
                                        
                                        <div class="form-group">
                                            <label for="newStatus" class="font-weight-bold">C·∫≠p nh·∫≠t tr·∫°ng th√°i:</label>
                                            <select class="form-control" id="newStatus" name="newStatus" required>
                                                <option value="">-- Ch·ªçn tr·∫°ng th√°i m·ªõi --</option>
                                                <option th:each="status : ${availableStatuses}" 
                                                        th:value="${status}" 
                                                        th:text="${status == 'SHIPPED' ? 'üöö ƒêang giao h√†ng' : 
                                                                 status == 'DELIVERED' ? 'üì¶ ƒê√£ giao h√†ng' : 
                                                                 status == 'CANCELLED' ? '‚ùå H·ªßy ƒë∆°n h√†ng' : status}">
                                                    Tr·∫°ng th√°i
                                                </option>
                                            </select>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary btn-block" id="submitButton">
                                            <i class="fas fa-save mr-1"></i>C·∫≠p nh·∫≠t tr·∫°ng th√°i
                                        </button>
                                    </form>
                                </div>

                                <div th:if="${availableStatuses == null or #lists.isEmpty(availableStatuses)}" 
                                     class="alert alert-info">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    Kh√¥ng th·ªÉ thay ƒë·ªïi tr·∫°ng th√°i c·ªßa ƒë∆°n h√†ng n√†y.
                                </div>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="card shadow mb-4" th:if="${order?.note}">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold">
                                    <i class="fas fa-sticky-note mr-2"></i>
                                    Ghi Ch√∫
                                </h6>
                            </div>
                            <div class="card-body">
                                <p class="mb-0" th:text="${order.note}">
                                    Ghi ch√∫ t·ª´ kh√°ch h√†ng...
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer class="sticky-footer bg-white" th:replace="~{admin/fragments/footer :: footer}"></footer>
    </div>
</div>

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<div th:replace="~{admin/fragments/logout :: logout}"></div>

<!-- Custom JavaScript -->
<script th:inline="none">
/*<![CDATA[*/
$(document).ready(function() {
    $('#updateStatusForm').on('submit', function(e) {
        var selectedStatus = $('#newStatus').val();
        var confirmMessages = {
            'SHIPPED': 'X√°c nh·∫≠n chuy·ªÉn sang tr·∫°ng th√°i "ƒêang giao h√†ng"?',
            'DELIVERED': 'X√°c nh·∫≠n ƒë√£ giao h√†ng th√†nh c√¥ng?',
            'CANCELLED': 'X√°c nh·∫≠n h·ªßy ƒë∆°n h√†ng n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.'
        };
        
        if (selectedStatus && confirmMessages[selectedStatus]) {
            if (!confirm(confirmMessages[selectedStatus])) {
                e.preventDefault();
                return false;
            }
        }
    });
});
/*]]>*/
</script>

</body>
</html> 